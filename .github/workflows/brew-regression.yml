# ref, https://stackoverflow.com/questions/71791532/github-actions-homebrew-install-terraform-version-lags-behind
name: brew-regression

# ref, https://github.blog/changelog/2022-09-26-github-actions-dynamic-names-for-workflow-runs/
run-name: regression test ${{inputs.formula}}

on:
  push:
    branches:
      - main
  workflow_dispatch:
    inputs:
      formula:
        description: Formula name
        required: true

env:
  # `test` and `audit` are test dev commands
  HOMEBREW_DEVELOPER: 1
  HOMEBREW_NO_AUTO_UPDATE: 1
  HOMEBREW_NO_ANALYTICS: 1
  # save some time
  HOMEBREW_NO_INSTALL_CLEANUP: 1
  # no need to upgrade dependants
  HOMEBREW_NO_INSTALLED_DEPENDENTS_CHECK: 1
  # https://github.com/Homebrew/homebrew-test-bot/pull/868
  HOMEBREW_NO_INSTALL_FROM_API: 1

jobs:
  macos-build:
    name: ${{ matrix.os }} test
    runs-on: ${{ matrix.os }}
    strategy:
      fail-fast: false
      matrix:
        os:
          # - macos-12
          # - macos-13
          - macos-14
    steps:
      - run: |
          brew update
          brew tap trailofbits/brew-verify
          brew verify bltool
          brew verify bnd
          brew verify boom-completion
          brew verify boot-clj
          brew verify brag
          brew verify brew-gem
          brew verify brew-php-switcher
          brew verify briss
          brew verify bundler-completion
          brew verify burst
          brew verify bwidget
          brew verify byobu
          brew verify byteman
          brew verify c
          brew verify ca-certificates
          brew verify cadubi
          brew verify calabash
          brew verify cask
          brew verify cassandra-reaper
          brew verify cereal
          brew verify ceylon
          brew verify cgal
          brew verify cgvg
          brew verify chalk-cli
          brew verify chardet
          brew verify chcase
          brew verify checkbashisms
          brew verify checkdmarc
          brew verify checkstyle
          brew verify chrome-export
          brew verify chruby-fish
          brew verify civl
          brew verify ckan
          brew verify clearlooks-phenix
          brew verify cli11
          brew verify clitest
          brew verify clojure-lsp
          brew verify clojure
          brew verify clojurescript
          brew verify closure-compiler
          brew verify cloud-watch
          brew verify cmake-language-server
          brew verify cmrc
          brew verify coda-cli
          brew verify coffeescript
          brew verify colordiff
          brew verify colormake
          brew verify commandbox
          brew verify conda-zsh-completion
          brew verify corepack
          brew verify cotila
          brew verify coursier
          brew verify cpanminus
          brew verify cpp-gsl
          brew verify cpp-httplib
          brew verify cpptoml
          brew verify cppzmq
          brew verify cqlkit
          brew verify crash
          brew verify create-dmg
          brew verify crow
          brew verify crowdin
          brew verify css-crush
          brew verify csshx
          brew verify cvsutils
          brew verify cxxopts
          brew verify cypher-shell
          brew verify czg
          brew verify dasht
          brew verify datatype99
          brew verify davmail
          brew verify db-vcs
          brew verify ddgr
          brew verify debugbreak
          brew verify deheader
          brew verify denominator
          brew verify dependency-check
          brew verify deployer
          brew verify derby
          brew verify desk
          brew verify detekt
          brew verify dex2jar
          brew verify diff-so-fancy
          brew verify digdag
          brew verify distribution
          brew verify ditaa
          brew verify django-completion
          brew verify djl-serving
          brew verify djvu2pdf
          brew verify dnsgen
          brew verify docbook-xsl
          brew verify docbook
          brew verify docker-clean
          brew verify docker-completion
          brew verify docker-machine-nfs
          brew verify docker-squash
          brew verify doctest
          brew verify docutils
          brew verify docx2txt
          brew verify doubledown
          brew verify drake
          brew verify dropbox-uploader
          brew verify dunamai
          brew verify dupseek
          brew verify dyld-headers
          brew verify dynaconf
          brew verify dzr
          brew verify easy-rsa
          brew verify ecs-deploy
          brew verify eigen
          brew verify eless
          brew verify elixir-ls
          brew verify emacs-dracula
          brew verify embulk
          brew verify emojify
          brew verify ensmallen
          brew verify epr
          brew verify epubcheck
          brew verify etl
          brew verify euler-py
          brew verify excel-compare
          brew verify extra-cmake-modules
          brew verify fabric-completion
          brew verify fabric-installer
          brew verify fantom
          brew verify fast_float
          brew verify fastqc
          brew verify fatal
          brew verify fennel
          brew verify fern-api
          brew verify fff
          brew verify ffind
          brew verify fgbio
          brew verify fierce
          brew verify fileicon
          brew verify finatra
          brew verify fisher
          brew verify flamegraph
          brew verify flank
          brew verify flash
          brew verify flume
          brew verify flyway
          brew verify fmpp
          brew verify fnlfmt
          brew verify fop
          brew verify forgit
          brew verify format-udf
          brew verify fortls
          brew verify fpp
          brew verify frege-repl
          brew verify frege
          brew verify frozen
          brew verify funcoeszz
          brew verify functionalplus
          brew verify fuseki
          brew verify g2
          brew verify galen
          brew verify gallery-dl
          brew verify gcem
          brew verify gcviewer
          brew verify gdrive-downloader
          brew verify gel
          brew verify gem-completion
          brew verify generate-json-schema
          brew verify geometry
          brew verify geoserver
          brew verify gifcap
          brew verify gifify
          brew verify gimme
          brew verify gist
          brew verify git-annex-remote-rclone
          brew verify git-archive-all
          brew verify git-extras
          brew verify git-filter-repo
          brew verify git-fixup
          brew verify git-flow
          brew verify git-fresh
          brew verify git-ftp
          brew verify git-game
          brew verify git-gui
          brew verify git-integration
          brew verify git-machete
          brew verify git-multipush
          brew verify git-now
          brew verify git-octopus
          brew verify git-open
          brew verify git-quick-stats
          brew verify git-recent
          brew verify git-remote-hg
          brew verify git-secrets
          brew verify git-split-diffs
          brew verify git-ssh
          brew verify git-standup
          brew verify git-svn-abandon
          brew verify git-test
          brew verify git-tools
          brew verify git-url-sub
          brew verify git-vendor
          brew verify git-when-merged
          brew verify github-keygen
          brew verify gitwatch
          brew verify glassfish
          brew verify gmail-backup
          brew verify golo
          brew verify google-java-format
          brew verify google-sql-tool
          brew verify goto
          brew verify gpcslots2
          brew verify gpm
          brew verify gradle-completion
          brew verify gradle-profiler
          brew verify gradle
          brew verify gradle@6
          brew verify gradle@7
          brew verify grammarly-languageserver
          brew verify graphqlviz
          brew verify grc
          brew verify grunt-completion
          brew verify gvp
          brew verify gws
          brew verify gwt
          brew verify h2
          brew verify h2c
          brew verify hapi-fhir-cli
          brew verify has
          brew verify hblock
          brew verify hg-fast-export
          brew verify hicolor-icon-theme
          brew verify historian
          brew verify hive
          brew verify homeshick
          brew verify hopscotch-map
          brew verify hr
          brew verify htmlcompressor
          brew verify httpstat
          brew verify hubflow
          brew verify hy
          brew verify icdiff
          brew verify idnits
          brew verify ievms
          brew verify igv
          brew verify imap-backup
          brew verify immer
          brew verify immich-cli
          brew verify indicators
          brew verify inja
          brew verify install-peerdeps
          brew verify instaloader
          brew verify interface99
          brew verify internetarchive
          brew verify ip_relay
          brew verify ipcalc
          brew verify iproute2mac
          brew verify iredis
          brew verify iso-codes
          brew verify isort
          brew verify ivy
          brew verify jadx
          brew verify jasmin
          brew verify jbake
          brew verify jbang
          brew verify jboss-forge
          brew verify jdnssec-tools
          brew verify jdtls
          brew verify jena
          brew verify jenkins-lts
          brew verify jenkins
          brew verify jenv
          brew verify jetty-runner
          brew verify jflex
          brew verify jhiccup
          brew verify jmeter
          brew verify jmxterm
          brew verify jolie
          brew verify jreleaser
          brew verify jsawk
          brew verify jsbeautifier
          brew verify jsdoc3
          brew verify jslint4java
          brew verify jsmn
          brew verify json5
          brew verify jsonlint
          brew verify jsonschema2pojo
          brew verify jvmtop
          brew verify kaitai-struct-compiler
          brew verify kanif
          brew verify kawa
          brew verify kerl
          brew verify keychain
          brew verify kin
          brew verify kitchen-completion
          brew verify kommit
          brew verify kotlin
          brew verify ktlint
          brew verify kube-ps1
          brew verify kubectx
          brew verify kumo
          brew verify kuto
          brew verify lager
          brew verify launchctl-completion
          brew verify leakcanary-shark
          brew verify leiningen
          brew verify lesspipe
          brew verify linklint
          brew verify liquidprompt
          brew verify lit
          brew verify litecli
          brew verify localtunnel
          brew verify logcheck
          brew verify lorem
          brew verify lsix
          brew verify lsusb-laniksj
          brew verify lsusb
          brew verify luaver
          brew verify lv2
          brew verify libdivide
          brew verify libosmium
          brew verify libpthread-stubs
          brew verify mackup
          brew verify maclaunch
          brew verify magic_enum
          brew verify mahout
          brew verify makeself
          brew verify mallet
          brew verify markdown-toc
          brew verify markdown
          brew verify markdownlint-cli2
          brew verify marked
          brew verify matlab2tikz
          brew verify maven-completion
          brew verify maven-shell
          brew verify mdds
          brew verify mdformat
          brew verify mdt
          brew verify mecab-unidic
          brew verify memcache-top
          brew verify meson
          brew verify metabase
          brew verify metalang99
          brew verify mhonarc
          brew verify mill
          brew verify mix-completion
          brew verify mkvdts2ac3
          brew verify mm-common
          brew verify mockserver
          brew verify moco
          brew verify modgit
          brew verify modman
          brew verify moz-git-tools
          brew verify mr
          brew verify msgpack-cxx
          brew verify multi-git-status
          brew verify mussh
          brew verify mvnvm
          brew verify mx
          brew verify mypaint-brushes
          brew verify mysql-search-replace
          brew verify nanobind
          brew verify nanoflann
          brew verify nanorc
          brew verify narwhal
          brew verify ncc
          brew verify negfix8
          brew verify neo4j
          brew verify neofetch
          brew verify nerdfetch
          brew verify netaddr
          brew verify netlistsvg
          brew verify netsurf-buildsystem
          brew verify nicovideo-dl
          brew verify nifi-registry
          brew verify nifi
          brew verify nlohmann-json
          brew verify node-build
          brew verify node-sass
          brew verify nodebrew
          brew verify nodeenv
          brew verify nuget
          brew verify numcpp
          brew verify nvm
          brew verify objc-run
          brew verify ohdear-cli
          brew verify okta-awscli
          brew verify onedpl
          brew verify open-completion
          brew verify openapi-generator
          brew verify openliberty-jakartaee8
          brew verify openliberty-jakartaee9
          brew verify openliberty-microprofile4
          brew verify openliberty-webprofile8
          brew verify openliberty-webprofile9
          brew verify orc-tools
          brew verify orientdb
          brew verify osinfo-db
          brew verify osmosis
          brew verify overarch
          brew verify overdrive
          brew verify pacapt
          brew verify packer-completion
          brew verify pacmc
          brew verify paket
          brew verify pandocomatic
          brew verify parallel-hashmap
          brew verify parallel
          brew verify pari-elldata
          brew verify pari-galdata
          brew verify pari-galpol
          brew verify pari-nflistdata
          brew verify pari-seadata-big
          brew verify pari-seadata
          brew verify parquet-cli
          brew verify pass-otp
          brew verify pastebinit
          brew verify pawk
          brew verify pax-construct
          brew verify pax-runner
          brew verify payara
          brew verify pegtl
          brew verify pex
          brew verify pgtoolkit
          brew verify pgtune
          brew verify phive
          brew verify php-code-sniffer
          brew verify php-cs-fixer
          brew verify phpmd
          brew verify phpunit
          brew verify picard-tools
          brew verify pidcat
          brew verify pig
          brew verify pinot
          brew verify pip-completion
          brew verify pipes-sh
          brew verify pius
          brew verify pkgdiff
          brew verify plantuml
          brew verify plog
          brew verify pmd
          brew verify portablegl
          brew verify ppss
          brew verify prestodb
          brew verify prettier
          brew verify prettierd
          brew verify prettyping
          brew verify procyon-decompiler
          brew verify proguard
          brew verify psgrep
          brew verify psql2csv
          brew verify psutils
          brew verify pter
          brew verify pulp
          brew verify pure
          brew verify purescript-language-server
          brew verify purr
          brew verify putmail-queue
          brew verify putmail
          brew verify pwned
          brew verify pybind11
          brew verify pycodestyle
          brew verify pyenv-ccache
          brew verify pyenv-pip-migrate
          brew verify pyenv-virtualenvwrapper
          brew verify pygments
          brew verify python-build
          brew verify python-markdown
          brew verify python-packaging
          brew verify python-setuptools
          brew verify python-tabulate
          brew verify python-trove-classifiers
          brew verify pyupgrade
          brew verify pywhat
          brew verify quantum++
          brew verify questdb
          brew verify quex
          brew verify quill
          brew verify rabbitmq
          brew verify rails-completion
          brew verify rake-completion
          brew verify range-v3
          brew verify rapidfuzz-cpp
          brew verify rapidjson
          brew verify rbenv-aliases
          brew verify rbenv-binstubs
          brew verify rbenv-bundle-exec
          brew verify rbenv-bundler-ruby-version
          brew verify rbenv-bundler
          brew verify rbenv-chefdk
          brew verify rbenv-communal-gems
          brew verify rbenv-ctags
          brew verify rbenv-default-gems
          brew verify rbenv-vars
          brew verify rbenv
          brew verify rcm
          brew verify react-native-cli
          brew verify redo
          brew verify redpen
          brew verify regipy
          brew verify reorder-python-imports
          brew verify repl
          brew verify repo
          brew verify retire
          brew verify rfcstrip
          brew verify rhino
          brew verify riemann
          brew verify rmate
          brew verify robin-map
          brew verify roblox-ts
          brew verify roundup
          brew verify rst-lint
          brew verify rsync-time-backup
          brew verify ruby-build
          brew verify ruby-completion
          brew verify ruby-install
          brew verify ruff-lsp
          brew verify runcocoa
          brew verify rustc-completion
          brew verify ry
          brew verify s4cmd
          brew verify safeint
          brew verify savana
          brew verify saxon-b
          brew verify saxon
          brew verify sbt
          brew verify sbtenv
          brew verify sbuild
          brew verify scala
          brew verify scala@2.12
          brew verify scala@2.13
          brew verify scala@3.3
          brew verify scalaenv
          brew verify scalariform
          brew verify scalastyle
          brew verify schema-evolution-manager
          brew verify scm-manager
          brew verify sdedit
          brew verify selecta
          brew verify selenium-server
          brew verify semtag
          brew verify shellshare
          brew verify shellspec
          brew verify shml
          brew verify shpotify
          brew verify shunit2
          brew verify simde
          brew verify six
          brew verify sjk
          brew verify ski
          brew verify skinny
          brew verify sloc
          brew verify slugify
          brew verify smartypants
          brew verify solr
          brew verify solr@8.11
          brew verify sonar-completion
          brew verify sonar-scanner
          brew verify sophus
          brew verify spaceman-diff
          brew verify span-lite
          brew verify spark
          brew verify spectra
          brew verify speedread
          brew verify spice-protocol
          brew verify spirv-headers
          brew verify spring-loaded
          brew verify sqlparse
          brew verify src
          brew verify sse2neon
          brew verify ssh-audit
          brew verify ssh-copy-id
          brew verify stanford-corenlp
          brew verify stanford-ner
          brew verify stanford-parser
          brew verify stdman
          brew verify storm
          brew verify stormssh-completion
          brew verify structurizr-cli
          brew verify style-check
          brew verify sub2srt
          brew verify svgo
          brew verify swagger2markup-cli
          brew verify swaks
          brew verify t-completion
          brew verify tailor
          brew verify tccutil
          brew verify tclap
          brew verify termcolor
          brew verify terraform_landscape
          brew verify terraform-local
          brew verify tesseract-lang
          brew verify testssl
          brew verify tfenv
          brew verify tgenv
          brew verify timedog
          brew verify titlecase
          brew verify tl-expected
          brew verify tmpmail
          brew verify tmux-xpanes
          brew verify todo-txt
          brew verify tofuenv
          brew verify tomcat
          brew verify tomcat@8
          brew verify tomcat@9
          brew verify tomee-plume
          brew verify tomee-plus
          brew verify tomee-webprofile
          brew verify toml11
          brew verify toot
          brew verify topgit
          brew verify touca
          brew verify tpm
          brew verify transcrypt
          brew verify translate-shell
          brew verify trino
          brew verify ttmath
          brew verify twarc
          brew verify twoping
          brew verify typedb
          brew verify typescript-language-server
          brew verify typescript
          brew verify typewritten
          brew verify tzdiff
          brew verify ufbt
          brew verify ugit
          brew verify umlet
          brew verify umple
          brew verify unp
          brew verify urdfdom_headers
          brew verify usb.ids
          brew verify utf8cpp
          brew verify uthash
          brew verify v
          brew verify vagrant-completion
          brew verify valijson
          brew verify vassh
          brew verify vault-cli
          brew verify vert.x
          brew verify vf
          brew verify vimtutor-sequel
          brew verify vip
          brew verify virt-manager
          brew verify virtualhost.sh
          brew verify vnu
          brew verify vscode-langservers-extracted
          brew verify vulkan-headers
          brew verify vulture
          brew verify walkmod
          brew verify wartremover
          brew verify wcurl
          brew verify webkit2png
          brew verify webpod
          brew verify websocketpp
          brew verify wemux
          brew verify wgetpaste
          brew verify whatmp3
          brew verify whistle
          brew verify wifi-password
          brew verify willgit
          brew verify winetricks
          brew verify woof
          brew verify wp-cli-completion
          brew verify wrk-trello
          brew verify wtf
          brew verify xbitmaps
          brew verify xbyak
          brew verify xcb-proto
          brew verify xcenv
          brew verify xcode-build-server
          brew verify xcv
          brew verify xdg-ninja
          brew verify xkeyboardconfig
          brew verify xmlformat
          brew verify xmlsectool
          brew verify xsimd
          brew verify xtensor
          brew verify xtitle
          brew verify xtrans
          brew verify yadm
          brew verify yarn-completion
          brew verify yarn
          brew verify ydiff
          brew verify z.lua
          brew verify zanata-client
          brew verify zipkin
          brew verify zplug
          brew verify zsh-async
          brew verify zsh-autocomplete
          brew verify zsh-autopair
          brew verify zsh-autosuggestions
          brew verify zsh-completions
          brew verify zsh-git-prompt
          brew verify zsh-history-substring-search
          brew verify zsh-lovers
          brew verify zsh-navigation-tools
          brew verify zsh-syntax-highlighting
          brew verify zsh-vi-mode
          brew verify zsh-you-should-use
          brew verify zshdb
          brew verify zug
          brew verify zx

  # linux-build:
  #   name: ubuntu-24.04 test
  #   runs-on: ubuntu-24.04
  #   steps:
  #     - name: Set up Homebrew
  #       id: set-up-homebrew
  #       # https://github.com/Homebrew/actions/tree/master/setup-homebrew
  #       uses: Homebrew/actions/setup-homebrew@00f483c95eacf401cf9f4aa3746964071a747334
  #     - run: brew update
  #     - run: brew install ${{inputs.formula}} && brew test ${{inputs.formula}}
  #     - run: brew linkage --cached ${{inputs.formula}}
